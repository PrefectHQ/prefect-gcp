
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://PrefectHQ.github.io/prefect-gcp/aiplatform/">
      
      
        <link rel="prev" href="../cloud_run/">
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.1">
    
    
      
        <title>AI Platform - prefect-gcp</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.3bd4f189.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Source Code Pro"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prefect_gcp.aiplatform" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="prefect-gcp" class="md-header__button md-logo" aria-label="prefect-gcp" data-md-component="logo">
      
  <img src="../img/prefect-logo-mark-solid-white-500.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            prefect-gcp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              AI Platform
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/PrefectHQ/prefect-gcp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="prefect-gcp" class="md-nav__button md-logo" aria-label="prefect-gcp" data-md-component="logo">
      
  <img src="../img/prefect-logo-mark-solid-white-500.png" alt="logo">

    </a>
    prefect-gcp
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/PrefectHQ/prefect-gcp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../credentials/" class="md-nav__link">
        Credentials
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cloud_storage/" class="md-nav__link">
        Cloud Storage
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../bigquery/" class="md-nav__link">
        BigQuery
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../secret_manager/" class="md-nav__link">
        Secret Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cloud_run/" class="md-nav__link">
        Cloud Run
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          AI Platform
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        AI Platform
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob" class="md-nav__link">
    VertexAICustomTrainingJob
  </a>
  
    <nav class="md-nav" aria-label="VertexAICustomTrainingJob">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.accelerator_type" class="md-nav__link">
    accelerator_type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.gcp_credentials" class="md-nav__link">
    gcp_credentials
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.image" class="md-nav__link">
    image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.job_name" class="md-nav__link">
    job_name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.job_watch_poll_interval" class="md-nav__link">
    job_watch_poll_interval
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.machine_type" class="md-nav__link">
    machine_type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.maximum_run_time" class="md-nav__link">
    maximum_run_time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.network" class="md-nav__link">
    network
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.region" class="md-nav__link">
    region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.reserved_ip_ranges" class="md-nav__link">
    reserved_ip_ranges
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.service_account" class="md-nav__link">
    service_account
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob-methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.kill" class="md-nav__link">
    kill()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.preview" class="md-nav__link">
    preview()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJobResult" class="md-nav__link">
    VertexAICustomTrainingJobResult
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob" class="md-nav__link">
    VertexAICustomTrainingJob
  </a>
  
    <nav class="md-nav" aria-label="VertexAICustomTrainingJob">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.accelerator_type" class="md-nav__link">
    accelerator_type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.gcp_credentials" class="md-nav__link">
    gcp_credentials
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.image" class="md-nav__link">
    image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.job_name" class="md-nav__link">
    job_name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.job_watch_poll_interval" class="md-nav__link">
    job_watch_poll_interval
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.machine_type" class="md-nav__link">
    machine_type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.maximum_run_time" class="md-nav__link">
    maximum_run_time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.network" class="md-nav__link">
    network
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.region" class="md-nav__link">
    region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.reserved_ip_ranges" class="md-nav__link">
    reserved_ip_ranges
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.service_account" class="md-nav__link">
    service_account
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob-methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.kill" class="md-nav__link">
    kill()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.preview" class="md-nav__link">
    preview()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJob.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_gcp.aiplatform.VertexAICustomTrainingJobResult" class="md-nav__link">
    VertexAICustomTrainingJobResult
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<div class="doc doc-object doc-module">



<h1 id="prefect_gcp.aiplatform" class="doc doc-heading">
        <code>prefect_gcp.aiplatform</code>



</h1>

    <div class="doc doc-contents first">

      <p><span class="badge-api experimental"/></p>
<p>Integrations with Google AI Platform.</p>
<p>Note this module is experimental. The intefaces within may change without notice.</p>

<p><strong>Examples:</strong></p>
    <p>Run a job using Vertex AI Custom Training:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_gcp.credentials</span> <span class="kn">import</span> <span class="n">GcpCredentials</span>
<span class="kn">from</span> <span class="nn">prefect_gcp.aiplatform</span> <span class="kn">import</span> <span class="n">VertexAICustomTrainingJob</span>

<span class="n">gcp_credentials</span> <span class="o">=</span> <span class="n">GcpCredentials</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;BLOCK_NAME&quot;</span><span class="p">)</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">VertexAICustomTrainingJob</span><span class="p">(</span>
    <span class="n">region</span><span class="o">=</span><span class="s2">&quot;us-east1&quot;</span><span class="p">,</span>
    <span class="n">image</span><span class="o">=</span><span class="s2">&quot;us-docker.pkg.dev/cloudrun/container/job:latest&quot;</span><span class="p">,</span>
    <span class="n">gcp_credentials</span><span class="o">=</span><span class="n">gcp_credentials</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">job</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></p>
<p>Run a job that runs the command <code>echo hello world</code> using Google Cloud Run Jobs:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_gcp.credentials</span> <span class="kn">import</span> <span class="n">GcpCredentials</span>
<span class="kn">from</span> <span class="nn">prefect_gcp.aiplatform</span> <span class="kn">import</span> <span class="n">VertexAICustomTrainingJob</span>

<span class="n">gcp_credentials</span> <span class="o">=</span> <span class="n">GcpCredentials</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;BLOCK_NAME&quot;</span><span class="p">)</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">VertexAICustomTrainingJob</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;echo&quot;</span><span class="p">,</span> <span class="s2">&quot;hello world&quot;</span><span class="p">],</span>
    <span class="n">region</span><span class="o">=</span><span class="s2">&quot;us-east1&quot;</span><span class="p">,</span>
    <span class="n">image</span><span class="o">=</span><span class="s2">&quot;us-docker.pkg.dev/cloudrun/container/job:latest&quot;</span><span class="p">,</span>
    <span class="n">gcp_credentials</span><span class="o">=</span><span class="n">gcp_credentials</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">job</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></p>
<p>Preview job specs:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_gcp.credentials</span> <span class="kn">import</span> <span class="n">GcpCredentials</span>
<span class="kn">from</span> <span class="nn">prefect_gcp.aiplatform</span> <span class="kn">import</span> <span class="n">VertexAICustomTrainingJob</span>

<span class="n">gcp_credentials</span> <span class="o">=</span> <span class="n">GcpCredentials</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;BLOCK_NAME&quot;</span><span class="p">)</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">VertexAICustomTrainingJob</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;echo&quot;</span><span class="p">,</span> <span class="s2">&quot;hello world&quot;</span><span class="p">],</span>
    <span class="n">region</span><span class="o">=</span><span class="s2">&quot;us-east1&quot;</span><span class="p">,</span>
    <span class="n">image</span><span class="o">=</span><span class="s2">&quot;us-docker.pkg.dev/cloudrun/container/job:latest&quot;</span><span class="p">,</span>
    <span class="n">gcp_credentials</span><span class="o">=</span><span class="n">gcp_credentials</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">job</span><span class="o">.</span><span class="n">preview</span><span class="p">()</span>
</code></pre></div></p>



  <div class="doc doc-children">





<h2 id="prefect_gcp.aiplatform-classes">Classes</h2>

  <div class="doc doc-object doc-class">



<h3 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob" class="doc doc-heading">
        <code>
VertexAICustomTrainingJob            (<span title="prefect.infrastructure.base.Infrastructure">Infrastructure</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Infrastructure block used to run Vertex AI custom training jobs.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_gcp/aiplatform.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">VertexAICustomTrainingJob</span><span class="p">(</span><span class="n">Infrastructure</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Infrastructure block used to run Vertex AI custom training jobs.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_block_type_name</span> <span class="o">=</span> <span class="s2">&quot;Vertex AI Custom Training Job&quot;</span>
    <span class="n">_block_type_slug</span> <span class="o">=</span> <span class="s2">&quot;vertex-ai-custom-training-job&quot;</span>
    <span class="n">_logo_url</span> <span class="o">=</span> <span class="s2">&quot;https://images.ctfassets.net/gm98wzqotmnx/4CD4wwbiIKPkZDt4U3TEuW/c112fe85653da054b6d5334ef662bec4/gcp.png?h=250&quot;</span>  <span class="c1"># noqa</span>

    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;vertex-ai-custom-training-job&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="s2">&quot;vertex-ai-custom-training-job&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The slug for this task type.&quot;</span>
    <span class="p">)</span>

    <span class="n">gcp_credentials</span><span class="p">:</span> <span class="n">GcpCredentials</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">GcpCredentials</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;GCP credentials to use when running the configured &quot;</span>
            <span class="s2">&quot;Vertex AI training job.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">region</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=...</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The region where the Vertex AI custom training job resides.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">image</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=...</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Image Name&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The image to use for a new Vertex AI custom training job. This value must &quot;</span>
            <span class="s2">&quot;refer to an image within either Google Container Registry &quot;</span>
            <span class="s2">&quot;or Google Artifact Registry, like `gcr.io/&lt;project_name&gt;/&lt;repo&gt;/`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Environment Variables&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Environment variables to be passed to your Cloud Run Job.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">machine_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;n1-standard-4&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The machine type to use for the run, which controls the available &quot;</span>
        <span class="s2">&quot;CPU and memory.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">accelerator_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The type of accelerator to attach to the machine.&quot;</span>
    <span class="p">)</span>
    <span class="n">maximum_run_time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The maximum job running time.&quot;</span>
    <span class="p">)</span>
    <span class="n">network</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The full name of the Compute Engine network&quot;</span>
        <span class="s2">&quot;to which the Job should be peered. Private services access must &quot;</span>
        <span class="s2">&quot;already be configured for the network. If left unspecified, the job &quot;</span>
        <span class="s2">&quot;is not peered with any network.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">reserved_ip_ranges</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A list of names for the reserved ip ranges under the VPC &quot;</span>
        <span class="s2">&quot;network that can be used for this job. If set, we will deploy the job &quot;</span>
        <span class="s2">&quot;within the provided ip ranges. Otherwise, the job will be deployed to &quot;</span>
        <span class="s2">&quot;any ip ranges under the provided VPC network.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">service_account</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Specifies the service account to use &quot;</span>
            <span class="s2">&quot;as the run-as account in Vertex AI. The agent submitting jobs must have &quot;</span>
            <span class="s2">&quot;act-as permission on this run-as account. If unspecified, the AI &quot;</span>
            <span class="s2">&quot;Platform Custom Code Service Agent for the CustomJob&#39;s project is &quot;</span>
            <span class="s2">&quot;used. Takes precedence over the service account found in gcp_credentials, &quot;</span>
            <span class="s2">&quot;and required if a service account cannot be detected in gcp_credentials.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">job_watch_poll_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The amount of time to wait between GCP API calls while monitoring the &quot;</span>
            <span class="s2">&quot;state of a Vertex AI Job.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">job_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name can be up to 128 characters long and can be consist of any UTF-8 characters. Reference:</span>
<span class="sd">        https://cloud.google.com/python/docs/reference/aiplatform/latest/google.cloud.aiplatform.CustomJob#google_cloud_aiplatform_CustomJob_display_name</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">repo_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># `gcr.io/&lt;project_name&gt;/&lt;repo&gt;/`&quot;</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The provided image must be from either Google Container Registry &quot;</span>
                <span class="s2">&quot;or Google Artifact Registry&quot;</span>
            <span class="p">)</span>

        <span class="n">unique_suffix</span> <span class="o">=</span> <span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span>
        <span class="n">job_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">repo_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">unique_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">job_name</span>

    <span class="k">def</span> <span class="nf">preview</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a preview of the job definition that will be sent to GCP.&quot;&quot;&quot;</span>
        <span class="n">job_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_job_spec</span><span class="p">()</span>
        <span class="n">custom_job</span> <span class="o">=</span> <span class="n">CustomJob</span><span class="p">(</span><span class="n">display_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="n">job_spec</span><span class="o">=</span><span class="n">job_spec</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">custom_job</span><span class="p">)</span>  <span class="c1"># outputs a json string</span>

    <span class="k">def</span> <span class="nf">_build_job_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;CustomJobSpec&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds a job spec by gathering details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># gather worker pool spec</span>
        <span class="n">env_list</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">container_spec</span> <span class="o">=</span> <span class="n">ContainerSpec</span><span class="p">(</span>
            <span class="n">image_uri</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">env</span><span class="o">=</span><span class="n">env_list</span>
        <span class="p">)</span>
        <span class="n">machine_spec</span> <span class="o">=</span> <span class="n">MachineSpec</span><span class="p">(</span>
            <span class="n">machine_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">machine_type</span><span class="p">,</span> <span class="n">accelerator_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">accelerator_type</span>
        <span class="p">)</span>
        <span class="n">worker_pool_spec</span> <span class="o">=</span> <span class="n">WorkerPoolSpec</span><span class="p">(</span>
            <span class="n">container_spec</span><span class="o">=</span><span class="n">container_spec</span><span class="p">,</span> <span class="n">machine_spec</span><span class="o">=</span><span class="n">machine_spec</span><span class="p">,</span> <span class="n">replica_count</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="c1"># look for service account</span>
        <span class="n">service_account</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">service_account</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcp_credentials</span><span class="o">.</span><span class="n">_service_account_email</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">service_account</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Could not detect a service_account through gcp_credentials; &quot;</span>
                <span class="s2">&quot;please provide a service_account in VertexAICustomTrainingJob&quot;</span>
            <span class="p">)</span>

        <span class="c1"># build custom job specs</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">Duration</span><span class="p">()</span><span class="o">.</span><span class="n">FromTimedelta</span><span class="p">(</span><span class="n">td</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_run_time</span><span class="p">)</span>
        <span class="n">scheduling</span> <span class="o">=</span> <span class="n">Scheduling</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="n">job_spec</span> <span class="o">=</span> <span class="n">CustomJobSpec</span><span class="p">(</span>
            <span class="n">worker_pool_specs</span><span class="o">=</span><span class="p">[</span><span class="n">worker_pool_spec</span><span class="p">],</span>
            <span class="n">service_account</span><span class="o">=</span><span class="n">service_account</span><span class="p">,</span>
            <span class="n">scheduling</span><span class="o">=</span><span class="n">scheduling</span><span class="p">,</span>
            <span class="n">network</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
            <span class="n">reserved_ip_ranges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reserved_ip_ranges</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">job_spec</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_create_and_begin_job</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">job_spec</span><span class="p">:</span> <span class="s2">&quot;CustomJobSpec&quot;</span><span class="p">,</span> <span class="n">job_service_client</span><span class="p">:</span> <span class="s2">&quot;JobServiceClient&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;CustomJob&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds a custom job and begins running it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create custom job</span>
        <span class="n">custom_job</span> <span class="o">=</span> <span class="n">CustomJob</span><span class="p">(</span><span class="n">display_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="n">job_spec</span><span class="o">=</span><span class="n">job_spec</span><span class="p">)</span>

        <span class="c1"># run job</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Job </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="si">!r}</span><span class="s2"> starting to run &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;the command </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">)</span><span class="si">!r}</span><span class="s2"> in region &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="si">!r}</span><span class="s2"> using image </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="si">!r}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcp_credentials</span><span class="o">.</span><span class="n">project</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;projects/</span><span class="si">{</span><span class="n">project</span><span class="si">}</span><span class="s2">/locations/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">custom_job_run</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
            <span class="n">job_service_client</span><span class="o">.</span><span class="n">create_custom_job</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">resource_name</span><span class="p">,</span>
            <span class="n">custom_job</span><span class="o">=</span><span class="n">custom_job</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Job </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="si">!r}</span><span class="s2"> has successfully started; &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;the full job name is </span><span class="si">{</span><span class="n">custom_job_run</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">custom_job_run</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_watch_job_run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">full_job_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>  <span class="c1"># different from self.job_name</span>
        <span class="n">job_service_client</span><span class="p">:</span> <span class="s2">&quot;JobServiceClient&quot;</span><span class="p">,</span>
        <span class="n">current_state</span><span class="p">:</span> <span class="s2">&quot;JobState&quot;</span><span class="p">,</span>
        <span class="n">until_states</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;JobState&quot;</span><span class="p">],</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;CustomJob&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Polls job run to see if status changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_UNSPECIFIED</span>
        <span class="n">last_state</span> <span class="o">=</span> <span class="n">current_state</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">while</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">until_states</span><span class="p">:</span>
            <span class="n">job_run</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
                <span class="n">job_service_client</span><span class="o">.</span><span class="n">get_custom_job</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">full_job_name</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">job_run</span><span class="o">.</span><span class="n">state</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="n">last_state</span><span class="p">:</span>
                <span class="n">state_label</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">state</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="s2">&quot;state is now:&quot;</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="c1"># results in &quot;New job state is now: succeeded&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="si">}</span><span class="s2"> has new </span><span class="si">{</span><span class="n">state_label</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">last_state</span> <span class="o">=</span> <span class="n">state</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Intermittently, the job will not be described. We want to respect the</span>
                <span class="c1"># watch timeout though.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Job not found.&quot;</span><span class="p">)</span>

            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
            <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">elapsed_time</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Timed out after </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2">s while watching job for states &quot;</span>
                    <span class="s2">&quot;</span><span class="si">{until_states!r}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_watch_poll_interval</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">job_run</span>

    <span class="nd">@sync_compatible</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">task_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;TaskStatus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VertexAICustomTrainingJobResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the configured task on VertexAI.</span>

<span class="sd">        Args:</span>
<span class="sd">            task_status: An optional `TaskStatus` to update when the container starts.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The `VertexAICustomTrainingJobResult`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client_options</span> <span class="o">=</span> <span class="n">ClientOptions</span><span class="p">(</span>
            <span class="n">api_endpoint</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">-aiplatform.googleapis.com&quot;</span>
        <span class="p">)</span>

        <span class="n">job_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_job_spec</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcp_credentials</span><span class="o">.</span><span class="n">get_job_service_client</span><span class="p">(</span>
            <span class="n">client_options</span><span class="o">=</span><span class="n">client_options</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">job_service_client</span><span class="p">:</span>
            <span class="n">job_run</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_and_begin_job</span><span class="p">(</span><span class="n">job_spec</span><span class="p">,</span> <span class="n">job_service_client</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">task_status</span><span class="p">:</span>
                <span class="n">task_status</span><span class="o">.</span><span class="n">started</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">)</span>

            <span class="n">final_job_run</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_watch_job_run</span><span class="p">(</span>
                <span class="n">full_job_name</span><span class="o">=</span><span class="n">job_run</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">job_service_client</span><span class="o">=</span><span class="n">job_service_client</span><span class="p">,</span>
                <span class="n">current_state</span><span class="o">=</span><span class="n">job_run</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
                <span class="n">until_states</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_SUCCEEDED</span><span class="p">,</span>
                    <span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_FAILED</span><span class="p">,</span>
                    <span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_CANCELLED</span><span class="p">,</span>
                    <span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_EXPIRED</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_run_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span>
            <span class="p">)</span>

        <span class="n">error_msg</span> <span class="o">=</span> <span class="n">final_job_run</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">message</span>
        <span class="k">if</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">status_code</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">final_job_run</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_SUCCEEDED</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">VertexAICustomTrainingJobResult</span><span class="p">(</span>
            <span class="n">identifier</span><span class="o">=</span><span class="n">final_job_run</span><span class="o">.</span><span class="n">display_name</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status_code</span>
        <span class="p">)</span>

    <span class="nd">@sync_compatible</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">grace_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kill a job running Cloud Run.</span>

<span class="sd">        Args:</span>
<span class="sd">            identifier: The Vertex AI full job name, formatted like</span>
<span class="sd">                &quot;projects/{project}/locations/{location}/customJobs/{custom_job}&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The `VertexAICustomTrainingJobResult`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client_options</span> <span class="o">=</span> <span class="n">ClientOptions</span><span class="p">(</span>
            <span class="n">api_endpoint</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">-aiplatform.googleapis.com&quot;</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcp_credentials</span><span class="o">.</span><span class="n">get_job_service_client</span><span class="p">(</span>
            <span class="n">client_options</span><span class="o">=</span><span class="n">client_options</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">job_service_client</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_kill_job</span><span class="p">,</span>
                <span class="n">job_service_client</span><span class="o">=</span><span class="n">job_service_client</span><span class="p">,</span>
                <span class="n">full_job_name</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requested to cancel </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_kill_job</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">job_service_client</span><span class="p">:</span> <span class="s2">&quot;JobServiceClient&quot;</span><span class="p">,</span> <span class="n">full_job_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin wrapper around Job.delete, wrapping a try/except since</span>
<span class="sd">        Job is an independent class that doesn&#39;t have knowledge of</span>
<span class="sd">        CloudRunJob and its associated logic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cancel_custom_job_request</span> <span class="o">=</span> <span class="n">CancelCustomJobRequest</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">full_job_name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">job_service_client</span><span class="o">.</span><span class="n">cancel_custom_job</span><span class="p">(</span>
                <span class="n">request</span><span class="o">=</span><span class="n">cancel_custom_job_request</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;does not exist&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">InfrastructureNotFound</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot stop Vertex AI job; the job name </span><span class="si">{</span><span class="n">full_job_name</span><span class="si">!r}</span><span class="s2"> &quot;</span>
                    <span class="s2">&quot;could not be found.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
            <span class="k">raise</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_log_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal property for generating a prefix for logs where `name` may be null</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;VertexAICustomTrainingJob </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;VertexAICustomTrainingJob&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




<h4 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob-attributes">Attributes</h4>

  <div class="doc doc-object doc-attribute">



<h5 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob.accelerator_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">accelerator_type</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The type of accelerator to attach to the machine.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob.gcp_credentials" class="doc doc-heading">
<code class="highlight language-python"><span class="n">gcp_credentials</span><span class="p">:</span> <span class="n">GcpCredentials</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>GCP credentials to use when running the configured Vertex AI training job.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob.image" class="doc doc-heading">
<code class="highlight language-python"><span class="n">image</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The image to use for a new Vertex AI custom training job. This value must refer to an image within either Google Container Registry or Google Artifact Registry, like <code>gcr.io/&lt;project_name&gt;/&lt;repo&gt;/</code>.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob.job_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">job_name</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The name can be up to 128 characters long and can be consist of any UTF-8 characters. Reference:
https://cloud.google.com/python/docs/reference/aiplatform/latest/google.cloud.aiplatform.CustomJob#google_cloud_aiplatform_CustomJob_display_name</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob.job_watch_poll_interval" class="doc doc-heading">
<code class="highlight language-python"><span class="n">job_watch_poll_interval</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The amount of time to wait between GCP API calls while monitoring the state of a Vertex AI Job.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob.machine_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">machine_type</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The machine type to use for the run, which controls the available CPU and memory.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob.maximum_run_time" class="doc doc-heading">
<code class="highlight language-python"><span class="n">maximum_run_time</span><span class="p">:</span> <span class="n">timedelta</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The maximum job running time.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob.network" class="doc doc-heading">
<code class="highlight language-python"><span class="n">network</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The full name of the Compute Engine networkto which the Job should be peered. Private services access must already be configured for the network. If left unspecified, the job is not peered with any network.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob.region" class="doc doc-heading">
<code class="highlight language-python"><span class="n">region</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The region where the Vertex AI custom training job resides.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob.reserved_ip_ranges" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reserved_ip_ranges</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>A list of names for the reserved ip ranges under the VPC network that can be used for this job. If set, we will deploy the job within the provided ip ranges. Otherwise, the job will be deployed to any ip ranges under the provided VPC network.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob.service_account" class="doc doc-heading">
<code class="highlight language-python"><span class="n">service_account</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Specifies the service account to use as the run-as account in Vertex AI. The agent submitting jobs must have act-as permission on this run-as account. If unspecified, the AI Platform Custom Code Service Agent for the CustomJob's project is used. Takes precedence over the service account found in gcp_credentials, and required if a service account cannot be detected in gcp_credentials.</p>
    </div>

  </div>




<h4 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob-methods">Methods</h4>

  <div class="doc doc-object doc-method">



<h5 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob.kill" class="doc doc-heading">
<code class="highlight language-python"><span class="n">kill</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Kill a job running Cloud Run.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>identifier</code></td>
        <td><code>str</code></td>
        <td><p>The Vertex AI full job name, formatted like
"projects/{project}/locations/{location}/customJobs/{custom_job}".</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>None</code></td>
      <td><p>The <code>VertexAICustomTrainingJobResult</code>.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>prefect_gcp/aiplatform.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@sync_compatible</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">grace_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Kill a job running Cloud Run.</span>

<span class="sd">    Args:</span>
<span class="sd">        identifier: The Vertex AI full job name, formatted like</span>
<span class="sd">            &quot;projects/{project}/locations/{location}/customJobs/{custom_job}&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The `VertexAICustomTrainingJobResult`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client_options</span> <span class="o">=</span> <span class="n">ClientOptions</span><span class="p">(</span>
        <span class="n">api_endpoint</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">-aiplatform.googleapis.com&quot;</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcp_credentials</span><span class="o">.</span><span class="n">get_job_service_client</span><span class="p">(</span>
        <span class="n">client_options</span><span class="o">=</span><span class="n">client_options</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">job_service_client</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_kill_job</span><span class="p">,</span>
            <span class="n">job_service_client</span><span class="o">=</span><span class="n">job_service_client</span><span class="p">,</span>
            <span class="n">full_job_name</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requested to cancel </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob.preview" class="doc doc-heading">
<code class="highlight language-python"><span class="n">preview</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Generate a preview of the job definition that will be sent to GCP.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_gcp/aiplatform.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">preview</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a preview of the job definition that will be sent to GCP.&quot;&quot;&quot;</span>
    <span class="n">job_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_job_spec</span><span class="p">()</span>
    <span class="n">custom_job</span> <span class="o">=</span> <span class="n">CustomJob</span><span class="p">(</span><span class="n">display_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="n">job_spec</span><span class="o">=</span><span class="n">job_spec</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">custom_job</span><span class="p">)</span>  <span class="c1"># outputs a json string</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_gcp.aiplatform.VertexAICustomTrainingJob.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Run the configured task on VertexAI.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>task_status</code></td>
        <td><code>Optional[TaskStatus]</code></td>
        <td><p>An optional <code>TaskStatus</code> to update when the container starts.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>VertexAICustomTrainingJobResult</code></td>
      <td><p>The <code>VertexAICustomTrainingJobResult</code>.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>prefect_gcp/aiplatform.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@sync_compatible</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">task_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;TaskStatus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VertexAICustomTrainingJobResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run the configured task on VertexAI.</span>

<span class="sd">    Args:</span>
<span class="sd">        task_status: An optional `TaskStatus` to update when the container starts.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The `VertexAICustomTrainingJobResult`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client_options</span> <span class="o">=</span> <span class="n">ClientOptions</span><span class="p">(</span>
        <span class="n">api_endpoint</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">-aiplatform.googleapis.com&quot;</span>
    <span class="p">)</span>

    <span class="n">job_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_job_spec</span><span class="p">()</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcp_credentials</span><span class="o">.</span><span class="n">get_job_service_client</span><span class="p">(</span>
        <span class="n">client_options</span><span class="o">=</span><span class="n">client_options</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">job_service_client</span><span class="p">:</span>
        <span class="n">job_run</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_and_begin_job</span><span class="p">(</span><span class="n">job_spec</span><span class="p">,</span> <span class="n">job_service_client</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">task_status</span><span class="p">:</span>
            <span class="n">task_status</span><span class="o">.</span><span class="n">started</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">)</span>

        <span class="n">final_job_run</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_watch_job_run</span><span class="p">(</span>
            <span class="n">full_job_name</span><span class="o">=</span><span class="n">job_run</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">job_service_client</span><span class="o">=</span><span class="n">job_service_client</span><span class="p">,</span>
            <span class="n">current_state</span><span class="o">=</span><span class="n">job_run</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
            <span class="n">until_states</span><span class="o">=</span><span class="p">(</span>
                <span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_SUCCEEDED</span><span class="p">,</span>
                <span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_FAILED</span><span class="p">,</span>
                <span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_CANCELLED</span><span class="p">,</span>
                <span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_EXPIRED</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_run_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">final_job_run</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">message</span>
    <span class="k">if</span> <span class="n">error_msg</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">status_code</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">final_job_run</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_SUCCEEDED</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">VertexAICustomTrainingJobResult</span><span class="p">(</span>
        <span class="n">identifier</span><span class="o">=</span><span class="n">final_job_run</span><span class="o">.</span><span class="n">display_name</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status_code</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="prefect_gcp.aiplatform.VertexAICustomTrainingJobResult" class="doc doc-heading">
        <code>
VertexAICustomTrainingJobResult            (<span title="prefect.infrastructure.base.InfrastructureResult">InfrastructureResult</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Result from a Vertex AI custom training job.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_gcp/aiplatform.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">VertexAICustomTrainingJobResult</span><span class="p">(</span><span class="n">InfrastructureResult</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Result from a Vertex AI custom training job.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>


    </div>

  </div>







  </div>

    </div>

  </div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.12658920.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5cf534bf.min.js"></script>
      
    
  </body>
</html>